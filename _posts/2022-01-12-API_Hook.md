---
title: "API Hook"
excerpt:

categories:
  - Blog
tags:
  - [API, Web]

toc: true
toc_sticky: true

date: 2022-01-12
last_modified_at: 2022-01-12
---

## Hooking(후킹)

후킹은 소프트웨어 구성요소 간에 발생하는 함수 호출, 메세지, 이벤트 등을 중간에 가로채서 구성 요소의 동작을 변경하거나 원래와는 다른 기능을 제공하는 기술입니다.

## 파이썬 Hook(코딩의 기술)

파이썬 내장 API 중 상당수는 함수를 전달해서 동작을 원하는 대로 바꿀 수 있게 해준다. API가 실행되는 과정에서 전달한 함수를 실행하는 경우, 이 함수를 훅(hook) 이라고 부른다.

예를 들어 sort 메서드는 정렬 시 각 인덱스에 대응하는 비교 값을 결정하는 선택적인 key 인자(훅)를 받을 수 있다.

```
names = ['소크라테스', '아르키메데스', '플라톤', '아리스토텔레스']
names.sort(key=len)
print(names)

>>>
['플라톤', '소크라테스', '아르키메데스', '아리스토텔레스']
```

훅을 추상 클래스(abstract class)를 통해 정의해야 하는 언어도 있지만, 파이썬에서는 단순히 인자와 반환 값이 잘 정의된, 상태가 없는 함수를 훅으로 사용하는 경우가 많다. 또한 파이썬은 함수를 일급 시민 객체(first-class citizen)로 취급하기 때문에 함수를 훅으로 사용할 수 있다.

예를 들어 defaultdict 클래스의 동작을 사용자 정의하고 싶다면, defaultdict에는 딕셔너리 안에 없는 키에 접근할 경우 호출되는 인자가 없는 함수를 전달할 수 있다.

```
def log_missing():
    print('키 추가됨')
    return 0

from collections import defaultdict

current = {'초록':12, '파랑':3}
increments = [
    ('빨강',5),
    ('파랑',17),
    ('주황',9),
]
result = defaultdict(log_missing, current)
print('이전:', dict(result))
for key, amount in increments:
    result[key] += amount
print('이후', dict(result))

>>>
이전: {'초록':12, '파랑':3}
키 추가됨
키 추가됨
이후: {'초록':12, '파랑':20, '빨강':5, '주황':9}
```

log_missing과 같은 함수를 사용할 수 있으면 정해진 동작과 부수 효과(side effect)를 분리할 수 있기 때문에 API를 더 쉽게 만들 수 있다.

defaultdict에 전달하는 디폴트 값 훅이 존재하지 않는 키에 접근한 총횟수를 세고 싶다고 하자. 이런 기능은 상태가 있는 클로저를 사용해 구현할 수 있다.
